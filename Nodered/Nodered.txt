Final
[{"id":"13959ba7.6224c4","type":"tab","label":"Sigfox","disabled":false,"info":""},{"id":"6f37e44.4b02a1c","type":"tcp in","z":"13959ba7.6224c4","name":"","server":"server","host":"","port":"8060","datamode":"single","datatype":"utf8","newline":"","topic":"","base64":false,"x":100,"y":60,"wires":[["e2c08f33.98943"]]},{"id":"cf750f51.8969d","type":"json","z":"13959ba7.6224c4","name":"","property":"payload","action":"","pretty":false,"x":230,"y":100,"wires":[["cb611eb7.4fd4b","fbc942a0.c8a8a","cb984438.0e5448"]]},{"id":"e2c08f33.98943","type":"split","z":"13959ba7.6224c4","name":"Split","splt":"{","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":230,"y":60,"wires":[["54f0f875.63acd8"]]},{"id":"54f0f875.63acd8","type":"function","z":"13959ba7.6224c4","name":"Add {","func":"msg.payload = '{' + msg.payload;\nvar i = msg.payload.length;\nif(i < 230)\n    {\n    msg.payload =i;\n    }\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":60,"wires":[["ce732841.31d748"]]},{"id":"ce732841.31d748","type":"switch","z":"13959ba7.6224c4","name":"","property":"payload","propertyType":"msg","rules":[{"t":"istype","v":"number","vt":"number"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":470,"y":60,"wires":[["403dcf71.53af7"],["cf750f51.8969d"]]},{"id":"403dcf71.53af7","type":"change","z":"13959ba7.6224c4","name":"Delete","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":60,"wires":[[]]},{"id":"cb611eb7.4fd4b","type":"function","z":"13959ba7.6224c4","name":"Get data","func":"msg.payload = msg.payload.data;\nreturn msg;","outputs":1,"noerr":0,"x":220,"y":140,"wires":[["65d69659.e01a38"]]},{"id":"5177665b.383be8","type":"function","z":"13959ba7.6224c4","name":"Write binData","func":"msg.topic = \"INSERT INTO `binData` (`time`, `temp`, `humid`, `lvl`, `mois`, `opn`, `lat`, `lng`) VALUES (CURRENT_TIMESTAMP, '\"+msg.payload[0]+\"', '\"+msg.payload[1]+\"', '\"+msg.payload[2]+\"', '\"+msg.payload[3]+\"', '\"+msg.payload[4]+\"', '\"+msg.payload[5]+\"', '\"+msg.payload[6]+\"')\";\nreturn msg;","outputs":1,"noerr":0,"x":680,"y":140,"wires":[["9a2d7386.54fc6"]]},{"id":"9a2d7386.54fc6","type":"mysql","z":"13959ba7.6224c4","mydb":"8ffddf33.c4124","name":"waste_bin","x":860,"y":160,"wires":[[]]},{"id":"65d69659.e01a38","type":"function","z":"13959ba7.6224c4","name":"Split into 2","func":"msg.payload = msg.payload.match(/.{1,2}/g);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":210,"y":180,"wires":[["96bbeaa.277d518"]]},{"id":"96bbeaa.277d518","type":"function","z":"13959ba7.6224c4","name":"HEX to DEC","func":"for(var i=0;i<msg.payload.length;i++)\n    {\n    msg.payload[i] = parseInt(msg.payload[i], 16);\n    if(i === 0)\n        {\n        msg.payload[i]=msg.payload[i]- 50;\n        }\n    }\nmsg.topic=\"sensor\";\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":220,"wires":[["6218f70a.f4a8f8"]]},{"id":"53f770f4.76374","type":"function","z":"13959ba7.6224c4","name":"Merge","func":"context.data = context.data || new Object();\n\nswitch (msg.topic) {\n    case \"sensor\":\n        context.data[0] = msg.payload[0];\n        context.data[1] = msg.payload[1];\n        context.data[2] = msg.payload[2];\n        context.data[3] = msg.payload[3];\n        context.data[4] = msg.payload[4];\n        msg = null;\n        break;\n    case \"lat\":\n        context.data[5] = msg.payload;\n        msg = null;\n        break;\n    case \"lng\":\n        context.data[6] = msg.payload;\n        msg = null;\n        break;\n        \n    default:\n        msg = null;\n    \tbreak;\n\n}\n\nif(context.data[0] != null && context.data[1] != null && context.data[2] != null && context.data[3] != null && context.data[4] != null && context.data[5] != null && context.data[6] != null) {\n\tmsg2 = new Object();\n    msg2.payload = context.data;\n    context.data=null;\n\treturn msg2;\n} else return msg;","outputs":1,"noerr":0,"x":530,"y":140,"wires":[["5177665b.383be8"]]},{"id":"fbc942a0.c8a8a","type":"function","z":"13959ba7.6224c4","name":"Get lat","func":"msg.topic=\"lat\";\nmsg.payload = msg.payload.lat;\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":100,"wires":[["53f770f4.76374"]]},{"id":"cb984438.0e5448","type":"function","z":"13959ba7.6224c4","name":"Get lng","func":"msg.topic=\"lng\";\nmsg.payload = msg.payload.lng;\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":140,"wires":[["53f770f4.76374"]]},{"id":"6218f70a.f4a8f8","type":"switch","z":"13959ba7.6224c4","name":"Check","property":"payload[1]","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":180,"wires":[["53f770f4.76374"],["46a6d8f4.6e6838"]]},{"id":"46a6d8f4.6e6838","type":"function","z":"13959ba7.6224c4","name":"Fire Value","func":"msg.payload = msg.payload[0] + 50;\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":180,"wires":[["979e18ba.7916a8"]]},{"id":"979e18ba.7916a8","type":"function","z":"13959ba7.6224c4","name":"Write fireData","func":"msg.topic = \"INSERT INTO `fireData` (`time`, `fire`) VALUES (CURRENT_TIMESTAMP, '\"+msg.payload+\"')\";\nreturn msg;","outputs":1,"noerr":0,"x":680,"y":180,"wires":[["9a2d7386.54fc6"]]},{"id":"8ffddf33.c4124","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"waste_bin","tz":""}]
